.PHONY: install build $(NAME) always

top_dir=../../
NAME=OMOptim
LIBNAME=OMOptimLib
DEST=../bin
APP=@APP@
EXE=@EXE@
QMAKE=@QMAKE@

install: build
	if [ "$(APP)" = ".app" ]; then cp -rp $(DEST)/$(NAME).app $(top_dir)/build/Applications/ ; else cp -p $(DEST)/$(NAME) $(top_dir)/build/bin/$(NAME); fi

always:

$(NAME): Makefile $(NAME).config $(LIBNAME)
	$(MAKE) -f Makefile

$(LIBNAME): MakefileLib
	$(MAKE) -f MakefileLib

build: $(LIBNAME) $(NAME)

Makefile: $(NAME).pro $(NAME).config
	$(QMAKE) $< -o $@
MakefileLib: $(LIBNAME).pro $(NAME).config
	$(QMAKE) $< -o $@
Makefile.unix: Makefile.unix.in
	(cd $(top_dir); ./config.status)
$(NAME).config: $(NAME).config.in
	(cd $(top_dir); ./config.status)

clean:
	test ! -f Makefile || $(MAKE) -f Makefile clean
	rm -f *.o *.a moc_* OMOptim

